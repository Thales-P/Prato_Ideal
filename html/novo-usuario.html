<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crie sua Conta - Prato Ideal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        #img-logo-nav { width: 50px; height: 50px; margin-right: 10px; }
        body { background-color: #f0f2f5; }
        .form-container { max-width: 500px; margin: 5vh auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

        /* --- CLASSES DE ACESSIBILIDADE (IDEALMENTE NO SEU style.css compartilhado) --- */
        body.font-small {
            font-size: 0.9em;
        }

        body.font-large {
            font-size: 1.1em;
        }

        body.font-larger {
            font-size: 1.2em;
        }

        body.grayscale-contrast {
            filter: grayscale(100%) !important;
            -webkit-filter: grayscale(100%) !important; /* Para compatibilidade com navegadores webkit */
        }

        body.high-contrast {
            background-color: #000000 !important; /* Fundo preto */
            color: #FFFF00 !important; /* Texto amarelo */
            /* Ajustes para elementos Bootstrap e outros elementos de texto */
            --bs-body-color: #FFFF00 !important;
            --bs-body-bg: #000000 !important;
            --bs-emphasis-color: #FFFFFF !important;
            --bs-secondary-color: #EEEEEE !important;
            --bs-primary-rgb: 255,255,0 !important;

            /* Elementos específicos */
            a { color: #00FF00 !important; }
            .navbar, .footer, .card-header, .modal-header {
                background-color: #333333 !important;
                color: #FFFFFF !important;
                border-color: #555555 !important;
            }
            .card, .modal-content, .form-container { /* Adicionado .form-container */
                background-color: #111111 !important;
                color: #FFFF00 !important;
                border-color: #555555 !important;
                box-shadow: 0 4px 12px rgba(255,255,0,0.3) !important;
            }
            .btn-primary { background-color: #00FF00 !important; border-color: #00FF00 !important; color: #000000 !important; }
            .btn-secondary { background-color: #666666 !important; border-color: #666666 !important; color: #FFFFFF !important; }
            .btn-outline-primary, .btn-outline-secondary, .btn-outline-dark { /* Ajustado para btn-outline-primary */
                color: #FFFF00 !important;
                border-color: #FFFF00 !important;
            }
            .btn-outline-primary:hover, .btn-outline-secondary:hover, .btn-outline-dark:hover {
                background-color: #FFFF00 !important;
                color: #000000 !important;
            }
            /* Inputs e Textareas */
            input, textarea {
                background-color: #333333 !important;
                color: #FFFF00 !important;
                border: 1px solid #777777 !important;
            }
            input::placeholder, textarea::placeholder {
                color: #AAAAAA !important;
            }
            /* Textos mutados */
            .text-muted {
                color: #CCCCCC !important;
            }
        }
        /* Opcional: Efeito para os botões do menu de acessibilidade ao serem clicados */
        #acessibility-toggle-btn:focus, #acessibility-toggle-btn:active {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
        }
    </style>
</head>
<body>
    <button class="btn btn-primary btn-lg rounded-circle shadow" id="acessibility-toggle-btn"
            style="position: fixed; bottom: 20px; right: 20px; z-index: 1050; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;"
            aria-label="Abrir menu de acessibilidade">
        <i class="fas fa-universal-access"></i>
    </button>

    <div id="acessibility-menu" class="card shadow"
         style="position: fixed; bottom: 90px; right: 20px; z-index: 1040; width: 250px; display: none;">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <span>Acessibilidade</span>
            <button type="button" class="btn-close btn-close-white" aria-label="Fechar menu" id="acessibility-close-btn"></button>
        </div>
        <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Tamanho da Fonte</h6>
            <div class="d-flex justify-content-around mb-3">
                <button class="btn btn-outline-secondary" id="font-decrease" aria-label="Diminuir fonte">A-</button>
                <button class="btn btn-outline-secondary" id="font-reset" aria-label="Tamanho padrão">A</button>
                <button class="btn btn-outline-secondary" id="font-increase" aria-label="Aumentar fonte">A+</button>
            </div>

            <h6 class="card-subtitle mb-2 text-muted">Contraste</h6>
            <div class="d-grid gap-2">
                <button class="btn btn-outline-dark" id="contrast-low" aria-label="Baixo Contraste (Tons de Cinza)">Tons de Cinza</button>
                <button class="btn btn-outline-dark" id="contrast-high" aria-label="Alto Contraste">Alto Contraste</button>
                <button class="btn btn-outline-dark" id="contrast-reset" aria-label="Contraste Padrão">Contraste Padrão</button>
            </div>
        </div>
    </div>

    <nav id="nav-top" class="navbar navbar-expand-md bg-light shadow-sm">
        <div class="container">
            <img id="img-logo-nav" src="../imagens/logo-preto.svg" alt="Logo" />
            <a class="navbar-brand fs-2 fw-bolder" href="../index.html">Prato Ideal</a>
            <a class="btn btn-outline-primary" href="login.html">Fazer Login</a>
        </div>
    </nav>

    <div class="container">
        <div class="form-container">
            <h2 class="text-center mb-4">Crie sua Conta</h2>
            <p class="text-center text-muted mb-4">É rápido e fácil.</p>

            <form id="form-cadastro" novalidate>
                <div class="mb-3">
                    <label for="nome" class="form-label">Nome Completo</label>
                    <input type="text" class="form-control" id="nome" required>
                    <div class="invalid-feedback">Por favor, insira seu nome.</div>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" required>
                    <div class="invalid-feedback">Por favor, insira um email válido.</div>
                </div>
                <div class="mb-3">
                    <label for="senha" class="form-label">Senha</label>
                    <input type="password" class="form-control" id="senha" required minlength="6">
                    <div class="invalid-feedback">A senha deve ter no mínimo 6 caracteres.</div>
                </div>
                <div class="mb-3">
                    <label for="confirmar-senha" class="form-label">Confirmar Senha</label>
                    <input type="password" class="form-control" id="confirmar-senha" required>
                    <div class="invalid-feedback">As senhas não correspondem.</div>
                </div>
                <div id="form-message" class="text-center mb-3"></div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <span id="btn-text">Cadastrar</span>
                        <span id="btn-spinner" class="spinner-border spinner-border-sm" style="display: none;" role="status" aria-hidden="true"></span>
                    </button>
                </div>
            </form>
            <div class="text-center mt-3">
                <small>Já tem uma conta? <a href="login.html">Faça o login</a></small>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ELEMENTOS E CONFIGURAÇÕES ---
            const form = document.getElementById('form-cadastro');
            const nomeInput = document.getElementById('nome');
            const emailInput = document.getElementById('email');
            const senhaInput = document.getElementById('senha');
            const confirmarSenhaInput = document.getElementById('confirmar-senha');
            const formMessage = document.getElementById('form-message');
            const btnText = document.getElementById('btn-text');
            const btnSpinner = document.getElementById('btn-spinner');

            const USUARIO_API_URL = 'https://apirestaurantes.onrender.com/api/Usuario';

            // --- LÓGICA DE SUBMISSÃO ---
            if (form) { // Adicionada verificação para o formulário
                form.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    resetValidation();
                    if (!validarFormulario()) {
                        form.classList.add('was-validated'); // Adiciona para mostrar feedback do Bootstrap
                        return;
                    }

                    if (btnText) btnText.textContent = 'Cadastrando...';
                    if (btnSpinner) btnSpinner.style.display = 'inline-block';
                    form.querySelector('button[type="submit"]').disabled = true;

                    try {
                        const dadosCadastro = {
                            Nome: nomeInput.value,
                            Email: emailInput.value,
                            Senha: senhaInput.value
                        };

                        const response = await fetch(`${USUARIO_API_URL}/cadastro`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(dadosCadastro)
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || `Erro do servidor: ${response.status}`);
                        }

                        const novoUsuario = await response.json();

                        if (formMessage) {
                            formMessage.className = 'text-center mb-3 text-success';
                            formMessage.textContent = 'Cadastro realizado com sucesso! Redirecionando...';
                        }

                        // Não salvar 'usuarioLogado' aqui, pois o login é feito na página de login
                        // localStorage.setItem('usuarioLogado', JSON.stringify(novoUsuario));
                        setTimeout(() => {
                            window.location.href = 'login.html'; // Redireciona para a página de login após o cadastro
                        }, 2000);

                    } catch (error) {
                        console.error("Erro no cadastro:", error);
                        if (formMessage) {
                            formMessage.className = 'text-center mb-3 text-danger';
                            formMessage.textContent = error.message;
                        }
                        if (btnText) btnText.textContent = 'Cadastrar';
                        if (btnSpinner) btnSpinner.style.display = 'none';
                        form.querySelector('button[type="submit"]').disabled = false;
                    }
                });
            }


            // --- FUNÇÕES AUXILIARES DE VALIDAÇÃO ---
            function validarFormulario() {
                let isValid = true;
                // Adicionadas verificações de existência antes de acessar .value ou .classList
                if (!nomeInput || !nomeInput.value.trim()) {
                    nomeInput?.classList.add('is-invalid');
                    isValid = false;
                } else {
                    nomeInput?.classList.remove('is-invalid');
                }
                if (!emailInput || !emailInput.value.trim() || !/^\S+@\S+\.\S+$/.test(emailInput.value)) {
                    emailInput?.classList.add('is-invalid');
                    isValid = false;
                } else {
                    emailInput?.classList.remove('is-invalid');
                }
                if (!senhaInput || senhaInput.value.length < 6) {
                    senhaInput?.classList.add('is-invalid');
                    isValid = false;
                } else {
                    senhaInput?.classList.remove('is-invalid');
                }
                if (!confirmarSenhaInput || senhaInput.value !== confirmarSenhaInput.value) {
                    confirmarSenhaInput?.classList.add('is-invalid');
                    isValid = false;
                } else {
                    confirmarSenhaInput?.classList.remove('is-invalid');
                }
                return isValid;
            }

            function resetValidation() {
                if (formMessage) formMessage.textContent = '';
                form?.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            }

            // --- LÓGICA DO MENU DE ACESSIBILIDADE ---
            const body = document.body;
            const fontDecreaseBtn = document.getElementById('font-decrease');
            const fontResetBtn = document.getElementById('font-reset');
            const fontIncreaseBtn = document.getElementById('font-increase');
            const contrastLowBtn = document.getElementById('contrast-low');
            const contrastHighBtn = document.getElementById('contrast-high');
            const contrastResetBtn = document.getElementById('contrast-reset');

            const acessibilityToggleBtn = document.getElementById('acessibility-toggle-btn');
            const acessibilityCloseBtn = document.getElementById('acessibility-close-btn');
            const acessibilityMenu = document.getElementById('acessibility-menu');

            const FONT_SIZES = ['font-small', '', 'font-large', 'font-larger'];
            let currentFontSizeIndex = 1;

            function applyFontSize(index) {
                FONT_SIZES.forEach(className => {
                    if (className) {
                        body.classList.remove(className);
                    }
                });
                if (FONT_SIZES[index]) {
                    body.classList.add(FONT_SIZES[index]);
                }
                localStorage.setItem('acessibilityFontSizeIndex', index);
                currentFontSizeIndex = index;
            }

            function applyContrast(mode) {
                body.classList.remove('grayscale-contrast', 'high-contrast');

                if (mode === 'low') {
                    body.classList.add('grayscale-contrast');
                } else if (mode === 'high') {
                    body.classList.add('high-contrast');
                }
                localStorage.setItem('acessibilityContrastMode', mode);
            }

            function loadAcessibilityPreferences() {
                const savedFontSizeIndex = localStorage.getItem('acessibilityFontSizeIndex');
                if (savedFontSizeIndex !== null) {
                    currentFontSizeIndex = parseInt(savedFontSizeIndex);
                    if (currentFontSizeIndex >= 0 && currentFontSizeIndex < FONT_SIZES.length) {
                        applyFontSize(currentFontSizeIndex);
                    } else {
                        applyFontSize(1);
                    }
                }

                const savedContrastMode = localStorage.getItem('acessibilityContrastMode');
                if (savedContrastMode) {
                    applyContrast(savedContrastMode);
                }
            }

            // Event Listeners para o menu de acessibilidade
            if (acessibilityToggleBtn && acessibilityMenu) {
                acessibilityToggleBtn.addEventListener('click', () => {
                    acessibilityMenu.style.display = acessibilityMenu.style.display === 'none' ? 'block' : 'none';
                    acessibilityToggleBtn.setAttribute('aria-expanded', acessibilityMenu.style.display === 'block');
                });
            }
            if (acessibilityCloseBtn && acessibilityMenu) {
                acessibilityCloseBtn.addEventListener('click', () => {
                    acessibilityMenu.style.display = 'none';
                    acessibilityToggleBtn.setAttribute('aria-expanded', 'false');
                });
            }

            if (fontDecreaseBtn) {
                fontDecreaseBtn.addEventListener('click', () => {
                    if (currentFontSizeIndex > 0) {
                        applyFontSize(currentFontSizeIndex - 1);
                    }
                });
            }

            if (fontResetBtn) {
                fontResetBtn.addEventListener('click', () => {
                    applyFontSize(1);
                });
            }

            if (fontIncreaseBtn) {
                fontIncreaseBtn.addEventListener('click', () => {
                    if (currentFontSizeIndex < FONT_SIZES.length - 1) {
                        applyFontSize(currentFontSizeIndex + 1);
                    }
                });
            }

            if (contrastLowBtn) {
                contrastLowBtn.addEventListener('click', () => applyContrast('low'));
            }

            if (contrastHighBtn) {
                contrastHighBtn.addEventListener('click', () => applyContrast('high'));
            }

            if (contrastResetBtn) {
                contrastResetBtn.addEventListener('click', () => applyContrast('default'));
            }

            // Carregar as preferências de acessibilidade assim que o DOM for carregado
            loadAcessibilityPreferences();
        });
    </script>
</body>
</html>